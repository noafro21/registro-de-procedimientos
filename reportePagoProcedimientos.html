<!DOCTYPE html>
<html lang="es" xml:lang="es">

<head>
    <title>Reporte de Pago de Procedimientos</title>
    <base target="_top">
    <?!= include('stylesReportePagoProcedimientos') ?>
    <?!= include('stylesBotonRegresar') ?>
</head>

<body>
    <!-- Bot√≥n para volver al men√∫ principal -->
    <button class="back-button" onclick="volverAlMenu()" title="Volver al Men√∫ Principal">
        <span class="back-button-icon">‚Üê</span>
    </button>

    <div id="reportControls">
        <h2>Reporte de Procedimiento</h2>
        
        <!-- ‚úÖ MENSAJE DE STATUS DIN√ÅMICO -->
        <div id="formMessage" class="message-container"></div>
        
        <label for="doctor">Seleccione personal:</label>
        <select id="doctor">
            <option disabled selected value="">Cargando personal...</option>
        </select>
        <button type="button" onclick="cargarEmailPersonal()" class="btn-small">üìß Cargar Email</button>

        <!-- ‚úÖ SELECTORES MEJORADOS - Se inicializar√°n din√°micamente -->
        <label for="mes">Mes:</label>
        <select id="mes">
            <option disabled value="">Seleccione un mes</option>
            <!-- Se llenar√°n din√°micamente -->
        </select>

        <label for="anio">A√±o:</label>
        <select id="anio">
            <option disabled value="">Seleccione un a√±o</option>
            <!-- Se llenar√°n din√°micamente -->
        </select>

        <label for="quincena">Quincena:</label>
        <select id="quincena">
            <option disabled value="">Seleccione una quincena</option>
            <!-- Se llenar√°n din√°micamente -->
        </select>

        <!-- ‚úÖ BOTONES DE ACCI√ìN MEJORADOS -->
        <div class="action-buttons">
            <button type="button" onclick="calcular()" class="btn-primary">üìä Calcular Reporte</button>
            <button type="button" onclick="actualizarSelectoresFecha()" class="btn-secondary">üîÑ Actualizar Fechas</button>
            <button type="button" onclick="mostrarAyudaFechas()" class="btn-help">‚ùì Ayuda Fechas</button>
        </div>
        
        <!-- ‚úÖ INFORMACI√ìN DE SELECCI√ìN ACTUAL -->
        <div id="seleccionActual" class="selection-info">
            <small>üìÖ Selecci√≥n actual: <span id="descripcionSeleccion">Ninguna</span></small>
        </div>
        
        <!-- ‚úÖ HERRAMIENTAS DE DEBUGGING EXPANDIDAS -->
        <details class="debug-tools">
            <summary class="debug-summary">üîß Herramientas de Debugging</summary>
            <div class="debug-buttons-grid">
                <button type="button" onclick="diagnosticarCalculo()" class="debug-btn debug-btn-primary">
                    üî¨ Diagnosticar C√°lculo
                </button>
                <button type="button" onclick="buscarPersonalPorNombre()" class="debug-btn debug-btn-purple">
                    üîé Buscar Personal
                </button>
                <button type="button" onclick="verificarDatosPersonal()" class="debug-btn debug-btn-blue">
                    üìä Verificar Datos
                </button>
                <button type="button" onclick="listarPersonalDisponible()" class="debug-btn debug-btn-green">
                    üë• Listar Personal
                </button>
                <button type="button" onclick="validarSeleccionFecha()" class="debug-btn debug-btn-yellow">
                    ‚úÖ Validar Fechas
                </button>
                <button type="button" onclick="mostrarLogConsola()" class="debug-btn debug-btn-gray">
                    üìã Ver Logs
                </button>
            </div>
        </details>
    </div>

    <!-- ‚úÖ √ÅREA DE RESULTADOS MEJORADA -->
    <div id="printableReportContent">
        <h2 id="reportTitle">Reporte de Pago de Procedimientos</h2>
        <div id="resultado"></div>
        <div class="totales-container">
            <h3 class="totales-title">Resumen de Totales</h3>
            <table class="totales-table">
                <thead>
                    <tr>
                        <th>Concepto</th>
                        <th>Valor</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="label-td">Subtotal original:</td>
                        <td class="value-td">‚Ç°<span id="subtotalOriginal">0.00</span></td>
                    </tr>
                    <tr class="solo-pantalla">
                        <td class="label-td">Descuento aplicado:</td>
                        <td class="value-td">
                            <input type="number" id="montoDescontar" min="0" step="0.01" placeholder="0.00">
                            <span id="montoDescontarTexto"></span>
                        </td>
                    </tr>
                    <tr class="solo-pantalla">
                        <td class="label-td">Extra (‚Ç°):</td>
                        <td class="value-td">
                            <input type="number" id="montoExtra" min="0" step="0.01" value="0" placeholder="0.00">
                            <span id="montoExtraTexto"></span>
                        </td>
                    </tr>
                    <tr class="solo-pantalla">
                        <td class="label-td">Motivo:</td>
                        <td class="value-td">
                            <input type="text" id="motivoDescuento" placeholder="Motivo del descuento o extra" maxlength="100">
                            <span id="motivoDescuentoTexto"></span>
                        </td>
                    </tr>
                    <tr>
                        <td class="label-td">Subtotal con ajustes:</td>
                        <td class="value-td">‚Ç°<span id="subtotalConDescuento">0.00</span></td>
                    </tr>
                    <tr class="grand-total-row">
                        <td><strong>GRAN TOTAL:</strong></td>
                        <td><strong>‚Ç°<span id="granTotal">0.00</span></strong></td>
                    </tr>
                </tbody>
            </table>
            <div id="comentarioDescuento" class="comment-section"></div>
        </div>
    </div>

    <!-- ‚úÖ SECCI√ìN DE ACCIONES MEJORADA -->
    <div id="action-section" style="display: none;">
        <h3>üìß Opciones de Reporte</h3>
        <div class="email-section">
            <label for="emailRecipient">Email Destinatario:</label>
            <input type="email" id="emailRecipient" placeholder="ejemplo@dominio.com" required />
            <div class="action-buttons">
                <button onclick="enviarReporteCostos()" class="btn-primary">üìß Enviar Reporte</button>
                <button onclick="descargarReporteCostosPDF()" class="btn-secondary">üíæ Descargar PDF</button>
            </div>
        </div>
        <div id="emailMessage" class="message-container"></div>
    </div>

    <!-- ‚úÖ √ÅREA DE AYUDA Y ESTADO -->
    <div id="statusArea" class="status-area">
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="spinner"></div>
            <span>Procesando...</span>
        </div>
    </div>

    <?!= include('scriptReportePagoProcedimientos'); ?>
    <?!= include('scriptBotonRegresar'); ?>
    <?!= include('scriptReportePagoProcedimientosUI'); ?>

</body>

</html>