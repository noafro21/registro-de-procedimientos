<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <?!= include('stylesReportePagoProcedimientos') ?>
    <?!= include('stylesBotonRegresar') ?>
</head>

<body>
    <!-- BotÃ³n para volver al menÃº principal -->
    <button class="back-button" onclick="volverAlMenu()" title="Volver al MenÃº Principal">
        <span class="back-button-icon">â†</span>
    </button>

    <div id="reportControls">
        <h2>Reporte de Procedimiento</h2>
        
        <!-- âœ… MENSAJE DE STATUS DINÃMICO -->
        <div id="formMessage" class="message-container"></div>
        
        <label for="doctor">Seleccione personal:</label>
        <select id="doctor">
            <option disabled selected value="">Cargando personal...</option>
        </select>
        <button type="button" onclick="cargarEmailPersonal()" class="btn-small">ğŸ“§ Cargar Email</button>

        <!-- âœ… SELECTORES MEJORADOS - Se inicializarÃ¡n dinÃ¡micamente -->
        <label for="mes">Mes:</label>
        <select id="mes">
            <option disabled value="">Seleccione un mes</option>
            <!-- Se llenarÃ¡n dinÃ¡micamente -->
        </select>

        <label for="anio">AÃ±o:</label>
        <select id="anio">
            <option disabled value="">Seleccione un aÃ±o</option>
            <!-- Se llenarÃ¡n dinÃ¡micamente -->
        </select>

        <label for="quincena">Quincena:</label>
        <select id="quincena">
            <option disabled value="">Seleccione una quincena</option>
            <!-- Se llenarÃ¡n dinÃ¡micamente -->
        </select>

        <!-- âœ… BOTONES DE ACCIÃ“N MEJORADOS -->
        <div class="action-buttons">
            <button type="button" onclick="calcular()" class="btn-primary">ğŸ“Š Calcular Reporte</button>
            <button type="button" onclick="actualizarSelectoresFecha()" class="btn-secondary">ğŸ”„ Actualizar Fechas</button>
            <button type="button" onclick="mostrarAyudaFechas()" class="btn-help">â“ Ayuda Fechas</button>
        </div>
        
        <!-- âœ… INFORMACIÃ“N DE SELECCIÃ“N ACTUAL -->
        <div id="seleccionActual" class="selection-info">
            <small>ğŸ“… SelecciÃ³n actual: <span id="descripcionSeleccion">Ninguna</span></small>
        </div>
        
        <!-- âœ… HERRAMIENTAS DE DEBUGGING EXPANDIDAS -->
        <details class="debug-tools">
            <summary class="debug-summary">ğŸ”§ Herramientas de Debugging</summary>
            <div class="debug-buttons-grid">
                <button type="button" onclick="diagnosticarCalculo()" class="debug-btn debug-btn-primary">
                    ğŸ”¬ Diagnosticar CÃ¡lculo
                </button>
                <button type="button" onclick="buscarPersonalPorNombre()" class="debug-btn debug-btn-purple">
                    ğŸ” Buscar Personal
                </button>
                <button type="button" onclick="verificarDatosPersonal()" class="debug-btn debug-btn-blue">
                    ğŸ“Š Verificar Datos
                </button>
                <button type="button" onclick="listarPersonalDisponible()" class="debug-btn debug-btn-green">
                    ğŸ‘¥ Listar Personal
                </button>
                <button type="button" onclick="validarSeleccionFecha()" class="debug-btn debug-btn-yellow">
                    âœ… Validar Fechas
                </button>
                <button type="button" onclick="mostrarLogConsola()" class="debug-btn debug-btn-gray">
                    ğŸ“‹ Ver Logs
                </button>
            </div>
        </details>
    </div>

    <!-- âœ… ÃREA DE RESULTADOS MEJORADA -->
    <div id="printableReportContent">
        <h2 id="reportTitle"></h2>
        <div id="resultado"></div>
        <div class="totales-container">
            <h3 class="totales-title">Resumen de Totales</h3>
            <table class="totales-table">
                <tr>
                    <td class="label-td">Subtotal original:</td>
                    <td class="value-td">â‚¡<span id="subtotalOriginal">0.00</span></td>
                </tr>
                <tr class="solo-pantalla">
                    <td class="label-td">Descuento aplicado:</td>
                    <td class="value-td">
                        <input type="number" id="montoDescontar" min="0" step="0.01" placeholder="0.00">
                        <span id="montoDescontarTexto"></span>
                    </td>
                </tr>
                <tr class="solo-pantalla">
                    <td class="label-td">Extra (â‚¡):</td>
                    <td class="value-td">
                        <input type="number" id="montoExtra" min="0" step="0.01" value="0" placeholder="0.00">
                        <span id="montoExtraTexto"></span>
                    </td>
                </tr>
                <tr class="solo-pantalla">
                    <td class="label-td">Motivo:</td>
                    <td class="value-td">
                        <input type="text" id="motivoDescuento" placeholder="Motivo del descuento o extra" maxlength="100">
                        <span id="motivoDescuentoTexto"></span>
                    </td>
                </tr>
                <tr>
                    <td class="label-td">Subtotal con ajustes:</td>
                    <td class="value-td">â‚¡<span id="subtotalConDescuento">0.00</span></td>
                </tr>
                <tr class="grand-total-row">
                    <td><strong>GRAN TOTAL:</strong></td>
                    <td><strong>â‚¡<span id="granTotal">0.00</span></strong></td>
                </tr>
            </table>
            <div id="comentarioDescuento" class="comment-section"></div>
        </div>
    </div>

    <!-- âœ… SECCIÃ“N DE ACCIONES MEJORADA -->
    <div id="action-section" style="display: none;">
        <h3>ğŸ“§ Opciones de Reporte</h3>
        <div class="email-section">
            <label for="emailRecipient">Email Destinatario:</label>
            <input type="email" id="emailRecipient" placeholder="ejemplo@dominio.com" required />
            <div class="action-buttons">
                <button onclick="enviarReporteCostos()" class="btn-primary">ğŸ“§ Enviar Reporte</button>
                <button onclick="descargarReporteCostosPDF()" class="btn-secondary">ğŸ’¾ Descargar PDF</button>
            </div>
        </div>
        <div id="emailMessage" class="message-container"></div>
    </div>

    <!-- âœ… ÃREA DE AYUDA Y ESTADO -->
    <div id="statusArea" class="status-area">
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="spinner"></div>
            <span>Procesando...</span>
        </div>
    </div>

    <?!= include('scriptReportePagoProcedimientos'); ?>
    <?!= include('scriptBotonRegresar'); ?>
    <?!= include('scriptReportePagoProcedimientosUI'); ?>

</body>

</html>